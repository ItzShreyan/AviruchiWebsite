<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Your Page Title</title>
</head>
<body>
<script src="products.js"></script>

<script>
/* ---------------------------------------------------------
   AVIRUCHI CHECKOUT ENGINE — ONE BIG SCRIPT
   Works with your existing products.js + localStorage basket
--------------------------------------------------------- */

// Load basket from localStorage
function loadCheckoutBasket() {
  const saved = localStorage.getItem("aviruchi_basket");
  return saved ? JSON.parse(saved) : [];
}

// Save basket back to localStorage
function saveCheckoutBasket(basket) {
  localStorage.setItem("aviruchi_basket", JSON.stringify(basket));
}

// Remove item by index
function removeFromBasket(index) {
  const basket = loadCheckoutBasket();
  basket.splice(index, 1);
  saveCheckoutBasket(basket);
  renderCheckoutBasket();
}

// Render basket summary on the right
function renderCheckoutBasket() {
  const basket = loadCheckoutBasket();

  const summaryEl = document.getElementById("basket-summary");
  const countEl = document.getElementById("checkout-count");
  const subtotalEl = document.getElementById("basket-subtotal");
  const totalEl = document.getElementById("basket-total");
  const headerCount = document.getElementById("basket-count");

  // Update basket count in header
  if (headerCount) {
    const totalItems = basket.reduce((sum, item) => sum + item.qty, 0);
    headerCount.textContent = totalItems;
  }

  // Update item count text
  if (countEl) {
    const totalItems = basket.reduce((sum, item) => sum + item.qty, 0);
    countEl.textContent = `${totalItems} items`;
  }

  // Render basket items
  if (summaryEl) {
    summaryEl.innerHTML = basket.map((item, index) => {
      const packLabel = item.pack ? ` (${item.pack.label})` : "";
      const price = item.pack?.price || 0;
      const subtotal = (price * item.qty).toFixed(2);

      return `
        <div class="basket-item">
          <div>
            <strong>${item.name}${packLabel}</strong>
            <div>Qty: ${item.qty}</div>
          </div>
          <div class="basket-item-right">
            <span>£${subtotal}</span>
            <button class="remove-btn" onclick="removeFromBasket(${index})">Remove</button>
          </div>
        </div>
      `;
    }).join("");
  }

  // Calculate totals
  const subtotal = basket.reduce((sum, item) => {
    const price = item.pack?.price || 0;
    return sum + item.qty * price;
  }, 0);

  if (subtotalEl) subtotalEl.textContent = `£${subtotal.toFixed(2)}`;
  if (totalEl) totalEl.textContent = `£${(subtotal + 3.99).toFixed(2)}`;
}

// Render suggested products on the left
function renderSuggestedProducts() {
  if (!window.PRODUCTS) return;

  const container = document.getElementById("suggested-products");
  if (!container) return;

  // Pick 6 random products
  const suggestions = [...PRODUCTS]
    .sort(() => Math.random() - 0.5)
    .slice(0, 6);

  container.innerHTML = suggestions.map(p => {
    const price = p.packSizes?.[0]?.price || 0;

    return `
      <li class="sidebar-link suggested-item">
        <strong>${p.name}</strong><br>
        <span>£${price.toFixed(2)}</span><br>
        <button class="suggested-add"
          onclick='addToBasket(PRODUCTS.find(x => x.id === "${p.id}"), 1, ${JSON.stringify(p.packSizes?.[0])})'>
          Add
        </button>
      </li>
    `;
  }).join("");
}

// Initialise checkout page
document.addEventListener("DOMContentLoaded", () => {
  renderCheckoutBasket();
  renderSuggestedProducts();
});
</script>

</body>
</html>





